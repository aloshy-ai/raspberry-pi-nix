#!/usr/bin/env bash

# Exit on error, undefined variables, and prevent pipeline errors from being masked
set -euo pipefail
IFS=$'\n\t'

# Script variables
IMAGE_NAME="wbond/pi-github-runner"
TAG="latest"

# Print commands before executing them
set -x

# Check if Docker is available
if ! command -v docker &> /dev/null; then
    echo "Error: Docker is not installed or not in PATH"
    exit 1
fi

# Build the image
echo "Building Docker image ${IMAGE_NAME}:${TAG}..."
docker build \
    --no-cache \
    --pull \
    -t "${IMAGE_NAME}:${TAG}" \
    "$(dirname "$0")"

echo "Build completed successfully!"
